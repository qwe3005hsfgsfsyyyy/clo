<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞...</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
            overflow: hidden;
        }
        
        .loader-container {
            text-align: center;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .mouse-prompt {
            margin-top: 30px;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .mouse-icon {
            width: 30px;
            height: 50px;
            border: 2px solid #333;
            border-radius: 15px;
            position: relative;
            margin-bottom: 10px;
        }
        
        .mouse-icon:before {
            content: '';
            width: 6px;
            height: 10px;
            background-color: #333;
            border-radius: 3px;
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            animation: scroll 1.5s infinite;
        }
        
        @keyframes scroll {
            0% { transform: translateX(-50%) translateY(0); opacity: 1; }
            100% { transform: translateX(-50%) translateY(15px); opacity: 0; }
        }
        
        .hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .mobile-only {
            display: none;
        }
        
        @media (max-width: 768px) {
            .desktop-only {
                display: none;
            }
            
            .mobile-only {
                display: block;
            }
        }

        .manual-redirect {
            display: none;
            margin-top: 30px;
            text-align: center;
        }

        .manual-redirect.visible {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .redirect-button {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 15px;
        }

        .redirect-button:hover {
            background-color: #2980b9;
        }

        .redirect-button:active {
            background-color: #1f6da8;
        }
    </style>
</head>
<body>
    <div class="loader-container">
        <h2>–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
        <div class="loader"></div>
        <div class="mouse-prompt desktop-only" id="mousePrompt">
            <div class="mouse-icon"></div>
            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ—à–µ–≤–µ–ª–∏—Ç–µ –º—ã—à—å—é –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</p>
        </div>
        <p class="mobile-only">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
        <div class="manual-redirect" id="manualRedirect">
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª.</p>
            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è:</p>
            <button class="redirect-button" id="redirectButton">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <script>
    // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
    const CONFIG = {
        // –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        baseRedirectDelay: 500, // –±–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –≤ –º—Å (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è)
        mouseMovementTimeout: 5000, // –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –≤ –º—Å
        botRedirectUrl: 'https://dzen.ru', // URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –±–æ—Ç–æ–≤
        
        // –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
        blockedIPsUrl: 'BlockIP.txt',
        blockedUAsUrl: 'BlockUAs.txt',
        linksUrl: 'links.txt',
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫
        checks: {
            mouseMovement: true,        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏
            headlessBrowser: false,      // –ü—Ä–æ–≤–µ—Ä–∫–∞ headless –±—Ä–∞—É–∑–µ—Ä–∞
            webdriver: true,            // –ü—Ä–æ–≤–µ—Ä–∫–∞ webdriver
            iframeYang: true,           // –ü—Ä–æ–≤–µ—Ä–∫–∞ iframe-yang.yandex
            blockedIPs: true,           // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö IP
            blockedUAs: true,           // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö UA
            screenParameters: false     // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —ç–∫—Ä–∞–Ω–∞ (–æ—Ç–∫–ª—é—á–µ–Ω–∞, —Ç.–∫. –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π)
        },
        
        // Telegram API
        telegram: {
            token: '7853695428:AAFhxiIHq67-UOQbP7bJ4FrH0EmwtWGswNU',
            chatId: '1237450939',
            retryAttempts: 2,           // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
            retryDelay: 500             // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ –≤ –º—Å
        },
        
        // –¢–∞–π–º–∞—É—Ç—ã –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        network: {
            // –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ (–º—Å)
            timeouts: {
                ip: 1500,
                location: 1500,
                links: 2000,
                blockedResources: 1000,
                redirect: 2000,
                manualRedirectShow: 10000 // –≤—Ä–µ–º—è –¥–æ –ø–æ–∫–∞–∑–∞ –∫–Ω–æ–ø–∫–∏ —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
            },
            
            // –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
            retries: {
                ip: 2,
                location: 2,
                links: 3,
                blockedResources: 1,
                redirect: 2
            },
            
            // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–º—Å)
            retryDelays: {
                ip: 300,
                location: 300,
                links: 500,
                blockedResources: 200,
                redirect: 1000
            }
        },

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π
        visitsTracking: {
            storageKey: 'userVisits', // –∫–ª—é—á –¥–ª—è localStorage
            maxStoredVisits: 10       // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—Ä–∞–Ω–∏–º—ã—Ö –≤–∏–∑–∏—Ç–æ–≤
        }
    };

    // ==================== –£–¢–ò–õ–ò–¢–´ ====================
    
    // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Promise –∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
    const promiseUtils = {
        // Promise —Å —Ç–∞–π–º–∞—É—Ç–æ–º
        withTimeout: (promise, timeoutMs, fallbackValue = null) => {
            let timeoutHandle;
            const timeoutPromise = new Promise(resolve => {
                timeoutHandle = setTimeout(() => resolve(fallbackValue), timeoutMs);
            });
            
            return Promise.race([
                promise.then(value => {
                    clearTimeout(timeoutHandle);
                    return value;
                }).catch(error => {
                    clearTimeout(timeoutHandle);
                    console.error('Promise error:', error);
                    return fallbackValue;
                }),
                timeoutPromise
            ]);
        },
        
        // Promise —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
        withRetry: async (fn, retries, delay, ...args) => {
            try {
                return await fn(...args);
            } catch (error) {
                if (retries <= 0) throw error;
                await new Promise(resolve => setTimeout(resolve, delay));
                return promiseUtils.withRetry(fn, retries - 1, delay * 1.5, ...args);
            }
        }
    };
    
    // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    const deviceInfo = {
        isMobile: () => {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        },
        isIOS: () => {
            return /iPhone|iPad|iPod/i.test(navigator.userAgent);
        },
        isZenApp: () => {
            return navigator.userAgent.includes('ru.zen.android');
        },
        getBrowserInfo: () => {
            const ua = navigator.userAgent;
            let browserName = "Unknown";
            let browserVersion = "";
            
            if (ua.indexOf("Firefox") > -1) {
                browserName = "Firefox";
                browserVersion = ua.match(/Firefox\/([0-9.]+)/)?.[1] || "";
            } else if (ua.indexOf("SamsungBrowser") > -1) {
                browserName = "Samsung Browser";
                browserVersion = ua.match(/SamsungBrowser\/([0-9.]+)/)?.[1] || "";
            } else if (ua.indexOf("Opera") > -1 || ua.indexOf("OPR") > -1) {
                browserName = "Opera";
                browserVersion = ua.indexOf("Opera") > -1 ? 
                    (ua.match(/Opera\/([0-9.]+)/)?.[1] || "") : 
                    (ua.match(/OPR\/([0-9.]+)/)?.[1] || "");
            } else if (ua.indexOf("Edg") > -1) {
                browserName = "Edge";
                browserVersion = ua.match(/Edg\/([0-9.]+)/)?.[1] || "";
            } else if (ua.indexOf("Chrome") > -1) {
                browserName = "Chrome";
                browserVersion = ua.match(/Chrome\/([0-9.]+)/)?.[1] || "";
            } else if (ua.indexOf("Safari") > -1) {
                browserName = "Safari";
                browserVersion = ua.match(/Safari\/([0-9.]+)/)?.[1] || "";
            } else if (ua.indexOf("MSIE") > -1 || ua.indexOf("Trident") > -1) {
                browserName = "Internet Explorer";
                browserVersion = ua.indexOf("MSIE") > -1 ? 
                    (ua.match(/MSIE ([0-9.]+)/)?.[1] || "") : 
                    (ua.match(/rv:([0-9.]+)/)?.[1] || "");
            }
            
            return `${browserName} ${browserVersion}`;
        },
        getOS: () => {
            const ua = navigator.userAgent;
            let os = "Unknown";
            
            if (ua.indexOf("Win") > -1) os = "Windows";
            else if (ua.indexOf("Mac") > -1) os = "MacOS";
            else if (ua.indexOf("X11") > -1) os = "UNIX";
            else if (ua.indexOf("Linux") > -1) os = "Linux";
            else if (ua.indexOf("Android") > -1) os = "Android";
            else if (ua.indexOf("iOS") > -1 || /iPhone|iPad|iPod/i.test(ua)) os = "iOS";
            
            return os;
        },
        getNetworkInfo: () => {
            if (!navigator.connection) return "Unknown";
            
            const conn = navigator.connection;
            return {
                type: conn.effectiveType || "Unknown",
                rtt: conn.rtt || 0,
                downlink: conn.downlink || 0,
                saveData: conn.saveData || false
            };
        }
    };

    // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ç—å—é
    const networkUtils = {
        // –ü–æ–ª—É—á–µ–Ω–∏–µ IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ API
        getIP: async () => {
            const ipApis = [
                { url: 'https://api.ipify.org?format=json', parser: (data) => data.ip },
                { url: 'https://api.db-ip.com/v2/free/self', parser: (data) => data.ipAddress },
                { url: 'https://api.myip.com', parser: (data) => data.ip },
                { url: 'https://ipinfo.io/json', parser: (data) => data.ip }
            ];
            
            for (const api of ipApis) {
                try {
                    const response = await promiseUtils.withTimeout(
                        fetch(api.url), 
                        CONFIG.network.timeouts.ip
                    );
                    
                    if (!response || !response.ok) continue;
                    
                    const data = await response.json();
                    const ip = api.parser(data);
                    
                    if (ip) return { ip, error: null };
                } catch (error) {
                    console.error(`Error fetching IP from ${api.url}:`, error);
                    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–æ —Å–ª–µ–¥—É—é—â–∏–º API
                }
            }
            
            return { ip: "unknown", error: "All IP APIs failed" };
        },
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –ø–æ IP —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ API
        getLocationByIP: async (ip) => {
            if (ip === "unknown") return { country: "unknown", city: "unknown", error: "No IP provided" };
            
            const locationApis = [
                { 
                    url: `https://ipapi.co/${ip}/json/`, 
                    parser: (data) => ({ 
                        country: data.country_name || "unknown", 
                        city: data.city || "unknown" 
                    })
                },
                { 
                    url: `https://ip-api.com/json/${ip}`, 
                    parser: (data) => ({ 
                        country: data.country || "unknown", 
                        city: data.city || "unknown" 
                    })
                },
                { 
                    url: `https://ipinfo.io/${ip}/json`, 
                    parser: (data) => ({ 
                        country: data.country || "unknown", 
                        city: data.city || "unknown" 
                    })
                }
            ];
            
            for (const api of locationApis) {
                try {
                    const response = await promiseUtils.withTimeout(
                        fetch(api.url), 
                        CONFIG.network.timeouts.location
                    );
                    
                    if (!response || !response.ok) continue;
                    
                    const data = await response.json();
                    return { ...api.parser(data), error: null };
                } catch (error) {
                    console.error(`Error fetching location from ${api.url}:`, error);
                    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–æ —Å–ª–µ–¥—É—é—â–∏–º API
                }
            }
            
            return { country: "unknown", city: "unknown", error: "All location APIs failed" };
        },
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å –±–ª–æ–∫–∏—Ä—É–µ–º—ã–º–∏ IP —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
        loadBlockedIPs: async () => {
            try {
                const response = await promiseUtils.withTimeout(
                    fetch(CONFIG.blockedIPsUrl),
                    CONFIG.network.timeouts.blockedResources
                );
                
                if (!response || !response.ok) return [];
                
                const text = await response.text();
                return text.split('\n')
                    .map(line => line.trim())
                    .filter(ip => ip !== '');
            } catch (error) {
                console.error("Error loading blocked IPs:", error);
                return [];
            }
        },
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å –±–ª–æ–∫–∏—Ä—É–µ–º—ã–º–∏ UA —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
        loadBlockedUAs: async () => {
            try {
                const response = await promiseUtils.withTimeout(
                    fetch(CONFIG.blockedUAsUrl),
                    CONFIG.network.timeouts.blockedResources
                );
                
                if (!response || !response.ok) return [];
                
                const text = await response.text();
                return text.split('\n')
                    .map(line => line.trim())
                    .filter(ua => ua !== '');
            } catch (error) {
                console.error("Error loading blocked UAs:", error);
                return [];
            }
        },
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å —Ü–µ–ª–µ–≤—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
        loadLinks: async () => {
            const loadLinksAttempt = async () => {
                const response = await fetch(CONFIG.linksUrl);
                if (!response.ok) {
                    throw new Error(`Failed to load links: ${response.status}`);
                }
                const text = await response.text();
                return text.split('\n')
                    .map(line => line.trim())
                    .filter(link => link !== '');
            };
            
            try {
                return await promiseUtils.withRetry(
                    loadLinksAttempt,
                    CONFIG.network.retries.links,
                    CONFIG.network.retryDelays.links
                );
            } catch (error) {
                console.error("Error loading links after retries:", error);
                return [];
            }
        },
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
        sendToTelegram: async (message, attempt = 1) => {
            if (attempt > CONFIG.telegram.retryAttempts) {
                console.error("Failed to send message to Telegram after multiple attempts");
                return false;
            }
            
            try {
                const url = `https://api.telegram.org/bot${CONFIG.telegram.token}/sendMessage`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CONFIG.telegram.chatId,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                
                const data = await response.json();
                
                if (!data.ok) {
                    console.error("Telegram API error:", data);
                    await new Promise(r => setTimeout(r, CONFIG.telegram.retryDelay));
                    return networkUtils.sendToTelegram(message, attempt + 1);
                }
                
                return true;
            } catch (error) {
                console.error("Error sending to Telegram:", error);
                await new Promise(r => setTimeout(r, CONFIG.telegram.retryDelay));
                return networkUtils.sendToTelegram(message, attempt + 1);
            }
        }
    };

    // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Å–µ—â–µ–Ω–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const visitsUtils = {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–µ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ –ø–µ—Ä–≤—ã–º
        isFirstVisit: () => {
            try {
                return localStorage.getItem(CONFIG.visitsTracking.storageKey) === null;
            } catch (error) {
                console.error("Error checking first visit:", error);
                return true; // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ localStorage, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ –ø–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç
            }
        },
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ—Å–µ—â–µ–Ω–∏–π –∏–∑ localStorage
        getVisitHistory: () => {
            try {
                const storedData = localStorage.getItem(CONFIG.visitsTracking.storageKey);
                return storedData ? JSON.parse(storedData) : [];
            } catch (error) {
                console.error("Error reading visit history:", error);
                return [];
            }
        },
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ—Å–µ—â–µ–Ω–∏–∏
        saveCurrentVisit: () => {
            try {
                const visits = visitsUtils.getVisitHistory();
                const currentTime = Date.now();
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ
                visits.push({
                    timestamp: currentTime,
                    userAgent: navigator.userAgent,
                    referrer: document.referrer || "direct"
                });
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–æ—Å–µ—â–µ–Ω–∏–π
                while (visits.length > CONFIG.visitsTracking.maxStoredVisits) {
                    visits.shift();
                }
                
                localStorage.setItem(CONFIG.visitsTracking.storageKey, JSON.stringify(visits));
                return visits;
            } catch (error) {
                console.error("Error saving visit:", error);
                return [];
            }
        },
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ—Å–µ—â–µ–Ω–∏—è—Ö –¥–ª—è –æ—Ç—á–µ—Ç–∞
        getVisitsInfo: () => {
            const isFirst = visitsUtils.isFirstVisit();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ
            const visits = visitsUtils.saveCurrentVisit();
            
            if (isFirst || visits.length <= 1) {
                return {
                    isFirstVisit: true,
                    totalVisits: 1, // –¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ
                    lastVisitTime: null,
                    timeSinceLastVisit: null
                };
            }
            
            const currentTime = Date.now();
            // –ë–µ—Ä–µ–º –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç (–ø–æ—Å–ª–µ–¥–Ω–∏–π - —ç—Ç–æ —Ç–µ–∫—É—â–∏–π, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏)
            const lastVisit = visits.length >= 2 ? visits[visits.length - 2] : null;
            
            if (!lastVisit) {
                return {
                    isFirstVisit: true,
                    totalVisits: 1,
                    lastVisitTime: null,
                    timeSinceLastVisit: null
                };
            }
            
            const timeSinceLastVisit = currentTime - lastVisit.timestamp;
            
            return {
                isFirstVisit: false,
                totalVisits: visits.length, // –í–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–µ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ
                lastVisitTime: new Date(lastVisit.timestamp).toISOString(),
                timeSinceLastVisit: Math.floor(timeSinceLastVisit / 1000) // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            };
        }
    };

    // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
    const redirectUtils = {
        // –ú–µ—Ç–æ–¥—ã —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è (–æ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–æ—Å—Å-–±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –∫ –º–µ–Ω–µ–µ)
        methods: [
            // –ú–µ—Ç–æ–¥ 1: location.href - —Å–∞–º—ã–π —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –º–µ—Ç–æ–¥
            (url) => { window.location.href = url; return true; },
            
            // –ú–µ—Ç–æ–¥ 2: location.replace - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
            (url) => { window.location.replace(url); return true; },
            
            // –ú–µ—Ç–æ–¥ 3: document.location
            (url) => { document.location = url; return true; },
            
            // –ú–µ—Ç–æ–¥ 4: meta refresh
            (url) => { 
                const meta = document.createElement('meta');
                meta.httpEquiv = 'refresh';
                meta.content = `0;url=${url}`;
                document.head.appendChild(meta);
                return true;
            },
            
            // –ú–µ—Ç–æ–¥ 5: window.open
            (url) => { window.open(url, '_self'); return true; }
        ],
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
        showManualRedirectButton: (url) => {
            const manualRedirect = document.getElementById('manualRedirect');
            const redirectButton = document.getElementById('redirectButton');
            
            if (manualRedirect && redirectButton) {
                manualRedirect.classList.add('visible');
                redirectButton.onclick = () => {
                    window.location.href = url;
                };
            }
        },
        
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
        redirect: async (url, delay = 0) => {
            if (delay > 0) {
                await new Promise(resolve => setTimeout(resolve, delay));
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø–æ—Å–ª–µ —Ç–∞–π–º–∞—É—Ç–∞
            setTimeout(() => {
                redirectUtils.showManualRedirectButton(url);
            }, CONFIG.network.timeouts.manualRedirectShow);
            
            let successfulMethod = null;
            let redirectAttempt = 0;
            const maxAttempts = CONFIG.network.retries.redirect + 1; // +1 –¥–ª—è –ø–µ—Ä–≤–æ–π –ø–æ–ø—ã—Ç–∫–∏
            
            while (redirectAttempt < maxAttempts) {
                // –ü–æ–ø—Ä–æ–±—É–µ–º –≤—Å–µ –º–µ—Ç–æ–¥—ã –ø–æ –æ—á–µ—Ä–µ–¥–∏
                for (const method of redirectUtils.methods) {
                    try {
                        const result = method(url);
                        if (result) {
                            successfulMethod = method.toString();
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ setTimeout
                            return new Promise((resolve) => {
                                const checkRedirectTimeout = setTimeout(() => {
                                    // –ï—Å–ª–∏ –º—ã –≤—Å–µ –µ—â–µ –∑–¥–µ—Å—å, –∑–Ω–∞—á–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
                                    resolve({ 
                                        success: false, 
                                        method: successfulMethod,
                                        attempts: redirectAttempt + 1
                                    });
                                }, CONFIG.network.timeouts.redirect);
                                
                                // –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
                                window.addEventListener('beforeunload', () => {
                                    clearTimeout(checkRedirectTimeout);
                                    resolve({ 
                                        success: true, 
                                        method: successfulMethod,
                                        attempts: redirectAttempt + 1
                                    });
                                }, { once: true });
                            });
                        }
                    } catch (error) {
                        console.error(`Redirect method failed (attempt ${redirectAttempt+1}):`, error);
                        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–æ —Å–ª–µ–¥—É—é—â–∏–º –º–µ—Ç–æ–¥–æ–º
                    }
                }
                
                // –ï—Å–ª–∏ –≤—Å–µ –º–µ—Ç–æ–¥—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –∏ –∂–¥–µ–º –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
                redirectAttempt++;
                if (redirectAttempt < maxAttempts) {
                    await new Promise(resolve => 
                        setTimeout(resolve, CONFIG.network.retryDelays.redirect * redirectAttempt)
                    );
                }
            }
            
            // –ï—Å–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —É–¥–∞–ª–∏—Å—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–µ—É–¥–∞—á—É
            return { 
                success: false, 
                method: "All methods failed", 
                attempts: redirectAttempt
            };
        }
    };

    // ==================== –î–ï–¢–ï–ö–¢–û–†–´ –ë–û–¢–û–í ====================
    
    const botDetector = {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ headless –±—Ä–∞—É–∑–µ—Ä–∞
        checkHeadlessBrowser: () => {
            // –ù–∞–±–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ headless –±—Ä–∞—É–∑–µ—Ä–∞
            const signals = [];
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è navigator
            if (!navigator) {
                signals.push("No navigator");
                return { isBot: true, reason: "No navigator object" };
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ plugins (–≤ headless –æ–±—ã—á–Ω–æ –ø—É—Å—Ç–æ –∏–ª–∏ –ø–æ–¥–¥–µ–ª–∞–Ω–æ)
            if (navigator.plugins) {
                if (navigator.plugins.length === 0) {
                    signals.push("No plugins");
                }
                
                // –í headless —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã —Å –ø—É—Å—Ç—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏
                if (navigator.plugins.length > 0) {
                    let hasEmptyPlugin = false;
                    for (let i = 0; i < navigator.plugins.length; i++) {
                        const plugin = navigator.plugins[i];
                        if (!plugin.name && !plugin.filename) {
                            hasEmptyPlugin = true;
                            break;
                        }
                    }
                    if (hasEmptyPlugin) {
                        signals.push("Empty plugin detected");
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ languages (–≤ headless —á–∞—Å—Ç–æ –ø—É—Å—Ç–æ)
            if (navigator.languages && navigator.languages.length === 0) {
                signals.push("No languages");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ inconsistent userAgent
            const userAgent = navigator.userAgent.toLowerCase();
            if (userAgent.includes('headless')) {
                signals.push("Headless in UA");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π –≤ User-Agent
            if (userAgent.includes('chrome') && !window.chrome) {
                signals.push("Chrome in UA but no chrome object");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ webdriver
            if (navigator.webdriver) {
                signals.push("webdriver=true");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è/–∞–Ω–æ–º–∞–ª–∏–π –≤ —Å–≤–æ–π—Å—Ç–≤–∞—Ö –¥–ª—è —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤
            if (userAgent.includes('mobile') || userAgent.includes('android') || userAgent.includes('iphone')) {
                // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã touch-—Å–æ–±—ã—Ç–∏—è
                if (!('ontouchstart' in window)) {
                    signals.push("Mobile UA but no touch events");
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω–æ–º–∞–ª–∏–π –≤ —Ä–∞–∑–º–µ—Ä–∞—Ö –æ–∫–Ω–∞/—ç–∫—Ä–∞–Ω–∞
            if (window.outerWidth === 0 || window.outerHeight === 0) {
                signals.push("Zero window dimensions");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏ –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ —ç–∫—Ä–∞–Ω–∞
            if (window.screen && (window.screen.width === 0 || window.screen.height === 0)) {
                signals.push("Zero screen dimensions");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ Notification API (–æ–±—ã—á–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ headless)
            if (!('Notification' in window)) {
                signals.push("No Notification API");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏ –≤ –æ—Ç–ø–µ—á–∞—Ç–∫–µ Canvas
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = "top";
                ctx.font = "14px 'Arial'";
                ctx.fillStyle = "#f60";
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = "#069";
                ctx.fillText("Hello, world!", 2, 15);
                ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
                ctx.fillText("Hello, world!", 4, 17);
                
                const dataURL = canvas.toDataURL();
                if (dataURL === "data:,") {
                    signals.push("Empty canvas fingerprint");
                }
            } catch (e) {
                signals.push("Canvas error");
            }
            
            // –ù–µ —Å—á–∏—Ç–∞–µ–º iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±–æ—Ç–∞–º–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–∏–≥–Ω–∞–ª—ã
            if (deviceInfo.isIOS() && signals.length < 3) {
                return { isBot: false, reason: "iOS device with acceptable signals" };
            }
            
            // –ï—Å–ª–∏ –Ω–∞–±—Ä–∞–ª–æ—Å—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, —Å—á–∏—Ç–∞–µ–º –±—Ä–∞—É–∑–µ—Ä headless
            const isBot = signals.length >= 2;
            return {
                isBot,
                reason: isBot ? `Headless browser detected: ${signals.join(", ")}` : "Not a headless browser"
            };
        },
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ webdriver
        checkWebdriver: () => {
            const signals = [];
            
            // –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤–∞ webdriver
            if (navigator.webdriver === true) {
                signals.push("navigator.webdriver=true");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Selenium
            if (typeof document.$cdc_asdjflasutopfhvcZLmcfl_ !== 'undefined' ||
                typeof document.$wdc_async_resume_ !== 'undefined' ||
                typeof document.$chrome_asyncScriptInfo !== 'undefined') {
                signals.push("Selenium detected");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ PhantomJS
            if (window._phantom || window.callPhantom) {
                signals.push("PhantomJS detected");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Nightmare.js
            if (window.__nightmare) {
                signals.push("Nightmare.js detected");
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Puppeteer
            if (navigator.userAgent.includes('HeadlessChrome')) {
                signals.push("Puppeteer detected");
            }
            
            // –ù–µ —Å—á–∏—Ç–∞–µ–º iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±–æ—Ç–∞–º–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–∏–≥–Ω–∞–ª—ã
            if (deviceInfo.isIOS() && signals.length < 2) {
                return { isBot: false, reason: "iOS device with acceptable signals" };
            }
            
            const isBot = signals.length > 0;
            return {
                isBot,
                reason: isBot ? `Webdriver detected: ${signals.join(", ")}` : "No webdriver detected"
            };
        },
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ iframe-yang.yandex
        checkIframeYang: () => {
            if (window.location !== window.parent.location) {
                try {
                    if (window.parent.location.href.includes('iframe-yang.yandex')) {
                        return { isBot: true, reason: "iframe-yang.yandex detected" };
                    }
                } catch (e) {
                    // –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É —Ñ—Ä–µ–π–º—É –∏–∑-–∑–∞ Same-Origin Policy
                    // –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–æ–º –±–æ—Ç–∞
                }
            }
            return { isBot: false, reason: "Not in iframe-yang" };
        },
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ IP –ø—Ä–æ—Ç–∏–≤ —Å–ø–∏—Å–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
        checkBlockedIP: (ip, blockedIPs) => {
            if (!ip || ip === "unknown" || !blockedIPs || blockedIPs.length === 0) {
                return { isBot: false, reason: "IP check skipped" };
            }
            
            const isBlocked = blockedIPs.includes(ip);
            return {
                isBot: isBlocked,
                reason: isBlocked ? `IP ${ip} is in block list` : `IP ${ip} is not blocked`
            };
        },
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ User-Agent –ø—Ä–æ—Ç–∏–≤ —Å–ø–∏—Å–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
        checkBlockedUA: (userAgent, blockedUAs) => {
            if (!userAgent || !blockedUAs || blockedUAs.length === 0) {
                return { isBot: false, reason: "UA check skipped" };
            }
            
            const ua = userAgent.toLowerCase();
            for (const blockedUA of blockedUAs) {
                if (blockedUA && blockedUA.trim() !== '' && ua.includes(blockedUA.toLowerCase())) {
                    return { isBot: true, reason: `UA contains blocked fragment: ${blockedUA}` };
                }
            }
            
            return { isBot: false, reason: "UA is not blocked" };
        }
    };

    // ==================== –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ====================
    
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    const state = {
        mouseMovementDetected: false,
        botDetectionResults: [],
        targetUrl: null,
        isBot: false,
        botReason: "",
        ipInfo: { ip: "unknown", error: null },
        locationInfo: { country: "unknown", city: "unknown", error: null },
        visitsInfo: null,
        redirectMethod: "",
        redirectSuccess: false,
        redirectAttempts: 0,
        startTime: Date.now(),
        processingTime: 0
    };

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–≥–æ URL
    const getTargetUrl = async () => {
        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        
        if (!code) {
            // –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ—Ñ–µ—Ä–µ—Ä –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π URL
            return document.referrer || CONFIG.botRedirectUrl;
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫
        const links = await networkUtils.loadLinks();
        
        if (!links || links.length === 0) {
            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Å—ã–ª–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ—Ñ–µ—Ä–µ—Ä –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π URL
            return document.referrer || CONFIG.botRedirectUrl;
        }
        
        const lineNumber = parseInt(code, 10);
        if (isNaN(lineNumber) || lineNumber < 1 || lineNumber > links.length) {
            // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ—Ñ–µ—Ä–µ—Ä –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π URL
            return document.referrer || CONFIG.botRedirectUrl;
        }
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Å—ã–ª–∫—É –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–æ–∫–∏ (—Å —É—á–µ—Ç–æ–º –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Å 0)
        return links[lineNumber - 1];
    };

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏
    const handleMouseMovement = () => {
        state.mouseMovementDetected = true;
        const mousePrompt = document.getElementById('mousePrompt');
        if (mousePrompt) {
            mousePrompt.classList.add('hidden');
        }
    };

    // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –¥–ª—è Telegram
    const prepareReport = (isRedirectFailure = false) => {
        const emoji = state.isBot ? "ü§ñ –ë–û–¢" : "üë§ –ß–ï–õ–û–í–ï–ö";
        const failureEmoji = isRedirectFailure ? "‚ùå –û–®–ò–ë–ö–ê –†–ï–î–ò–†–ï–ö–¢–ê" : "";
        const screenInfo = `${window.screen.width}x${window.screen.height}`;
        const windowInfo = `${window.innerWidth}x${window.innerHeight}`;
        const language = navigator.language || "unknown";
        const isMobile = deviceInfo.isMobile() ? "–î–∞" : "–ù–µ—Ç";
        const browser = deviceInfo.getBrowserInfo();
        const os = deviceInfo.getOS();
        const networkInfo = deviceInfo.getNetworkInfo();
        const networkType = typeof networkInfo === 'string' ? networkInfo : networkInfo.type;
        
        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–µ—â–µ–Ω–∏—è—Ö
        const visitsInfo = state.visitsInfo;
        let visitsText = "–ù/–î";
        
        if (visitsInfo) {
            if (visitsInfo.isFirstVisit) {
                visitsText = "–ü–µ—Ä–≤–æ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ";
            } else {
                const timeSinceLastVisitFormatted = visitsInfo.timeSinceLastVisit < 60 
                    ? `${visitsInfo.timeSinceLastVisit} —Å–µ–∫.` 
                    : visitsInfo.timeSinceLastVisit < 3600 
                        ? `${Math.floor(visitsInfo.timeSinceLastVisit / 60)} –º–∏–Ω.`
                        : visitsInfo.timeSinceLastVisit < 86400
                            ? `${Math.floor(visitsInfo.timeSinceLastVisit / 3600)} —á–∞—Å.`
                            : `${Math.floor(visitsInfo.timeSinceLastVisit / 86400)} –¥–Ω.`;
                
                visitsText = `${visitsInfo.totalVisits} –ø–æ—Å–µ—â–µ–Ω–∏–π, –ø–æ—Å–ª–µ–¥–Ω–µ–µ ${timeSinceLastVisitFormatted} –Ω–∞–∑–∞–¥`;
            }
        }
        
        return `
<b>${emoji} ${failureEmoji}</b>

<b>IP:</b> ${state.ipInfo.ip}
<b>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</b> ${state.locationInfo.city}, ${state.locationInfo.country}
<b>User-Agent:</b> ${navigator.userAgent}
<b>–ë—Ä–∞—É–∑–µ—Ä:</b> ${browser}
<b>–û–°:</b> ${os}
<b>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞:</b> ${screenInfo}
<b>–†–∞–∑–º–µ—Ä –æ–∫–Ω–∞:</b> ${windowInfo}
<b>–Ø–∑—ã–∫:</b> ${language}
<b>–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</b> ${isMobile}
<b>–¢–∏–ø —Å–µ—Ç–∏:</b> ${networkType}
<b>–ü–æ—Å–µ—â–µ–Ω–∏—è:</b> ${visitsText}
<b>–ú–µ—Ç–æ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞:</b> ${state.redirectMethod}
<b>–£—Å–ø–µ—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞:</b> ${state.redirectSuccess ? "–î–∞" : "–ù–µ—Ç"}
<b>–ü–æ–ø—ã—Ç–æ–∫ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞:</b> ${state.redirectAttempts}
<b>–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞:</b> ${state.targetUrl}
<b>–†–µ—Ñ–µ—Ä–µ—Ä:</b> ${document.referrer || "–ù–µ—Ç"}
<b>–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:</b> ${state.processingTime}ms

<b>–ü—Ä–∏—á–∏–Ω–∞ (–µ—Å–ª–∏ –±–æ—Ç):</b> ${state.botReason || "–ù/–î"}
`;
    };

    // –§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –î–∑–µ–Ω
    const fastRedirectForZen = async () => {
        // –ü–æ–ª—É—á–∞–µ–º —Ü–µ–ª–µ–≤–æ–π URL
        state.targetUrl = await getTargetUrl();
        
        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–µ—â–µ–Ω–∏—è—Ö
        state.visitsInfo = visitsUtils.getVisitsInfo();
        
        // –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç
        const redirectResult = await redirectUtils.redirect(state.targetUrl, CONFIG.baseRedirectDelay);
        state.redirectMethod = redirectResult.method;
        state.redirectSuccess = redirectResult.success;
        state.redirectAttempts = redirectResult.attempts || 1;
        
        // –ï—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ —É–¥–∞–ª—Å—è, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç
        if (!redirectResult.success) {
            try {
                state.ipInfo = await networkUtils.getIP();
                state.locationInfo = await networkUtils.getLocationByIP(state.ipInfo.ip);
                state.processingTime = Date.now() - state.startTime;
                
                const report = prepareReport(true);
                await networkUtils.sendToTelegram(report);
            } catch (error) {
                console.error("Failed to send failure report:", error);
            }
        }
    };

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
    const checkAndRedirect = async () => {
        try {
            // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –î–∑–µ–Ω, –±—ã—Å—Ç—Ä–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫
            if (deviceInfo.isZenApp()) {
                await fastRedirectForZen();
                return;
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
            const [
                ipInfo,
                targetUrl,
                blockedIPs,
                blockedUAs
            ] = await Promise.all([
                networkUtils.getIP(),
                getTargetUrl(),
                CONFIG.checks.blockedIPs ? networkUtils.loadBlockedIPs() : Promise.resolve([]),
                CONFIG.checks.blockedUAs ? networkUtils.loadBlockedUAs() : Promise.resolve([])
            ]);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            state.ipInfo = ipInfo;
            state.targetUrl = targetUrl;
            
            // –ü–æ–ª—É—á–∞–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ IP
            state.locationInfo = await networkUtils.getLocationByIP(ipInfo.ip);
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–µ—â–µ–Ω–∏—è—Ö
            state.visitsInfo = visitsUtils.getVisitsInfo();
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –±–æ—Ç–∞
            const checkResults = [];
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ webdriver (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
            if (CONFIG.checks.webdriver) {
                checkResults.push(botDetector.checkWebdriver());
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ iframe-yang (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
            if (CONFIG.checks.iframeYang) {
                checkResults.push(botDetector.checkIframeYang());
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ IP (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
            if (CONFIG.checks.blockedIPs && blockedIPs.length > 0) {
                checkResults.push(botDetector.checkBlockedIP(ipInfo.ip, blockedIPs));
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ UA (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
            if (CONFIG.checks.blockedUAs && blockedUAs.length > 0) {
                checkResults.push(botDetector.checkBlockedUA(navigator.userAgent, blockedUAs));
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ headless –±—Ä–∞—É–∑–µ—Ä–∞
            if (CONFIG.checks.headlessBrowser) {
                checkResults.push(botDetector.checkHeadlessBrowser());
            }
            
            // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏
            const isMobile = deviceInfo.isMobile();
            if (!isMobile && CONFIG.checks.mouseMovement) {
                // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏
                if (!state.mouseMovementDetected) {
                    checkResults.push({ 
                        isBot: true, 
                        reason: "No mouse movement detected" 
                    });
                }
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–æ—Ç–æ–º
            const botDetected = checkResults.some(result => result.isBot);
            
            state.isBot = botDetected;
            state.botReason = botDetected 
                ? checkResults.filter(r => r.isBot).map(r => r.reason).join("; ")
                : "";
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫—É–¥–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å
            const redirectUrl = botDetected ? CONFIG.botRedirectUrl : state.targetUrl;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
            state.processingTime = Date.now() - state.startTime;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç –≤ Telegram
            try {
                const report = prepareReport();
                await networkUtils.sendToTelegram(report);
            } catch (error) {
                console.error("Failed to send report to Telegram:", error);
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç —Å –±–∞–∑–æ–≤–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
            const redirectResult = await redirectUtils.redirect(redirectUrl, CONFIG.baseRedirectDelay);
            state.redirectMethod = redirectResult.method;
            state.redirectSuccess = redirectResult.success;
            state.redirectAttempts = redirectResult.attempts || 1;
            
            // –ï—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ —É–¥–∞–ª—Å—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±–æ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ
            if (!redirectResult.success && !botDetected) {
                try {
                    const failureReport = prepareReport(true);
                    await networkUtils.sendToTelegram(failureReport);
                } catch (error) {
                    console.error("Failed to send failure report:", error);
                }
            }
        } catch (error) {
            console.error("Critical error in checkAndRedirect:", error);
            
            // –í —Å–ª—É—á–∞–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏, –ø—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π URL
            try {
                const fallbackUrl = document.referrer || CONFIG.botRedirectUrl;
                await redirectUtils.redirect(fallbackUrl, CONFIG.baseRedirectDelay);
            } catch (redirectError) {
                console.error("Even fallback redirect failed:", redirectError);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
                redirectUtils.showManualRedirectButton(document.referrer || CONFIG.botRedirectUrl);
            }
        }
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    const init = () => {
        try {
            // –ó–∞–ø—Ä–µ—â–∞–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
            window.onpageshow = function(event) {
                if (event.persisted) {
                    window.location.reload();
                }
            };
            
            // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –î–∑–µ–Ω, –±—ã—Å—Ç—Ä–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫
            if (deviceInfo.isZenApp()) {
                fastRedirectForZen();
                return;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–æ–≤
            if (!deviceInfo.isMobile()) {
                document.addEventListener('mousemove', handleMouseMovement);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
                setTimeout(() => {
                    checkAndRedirect();
                }, CONFIG.mouseMovementTimeout);
            } else {
                // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
                checkAndRedirect();
            }
        } catch (error) {
            console.error("Critical error during initialization:", error);
            
            // –í —Å–ª—É—á–∞–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏, –ø—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π URL
            try {
                const fallbackUrl = document.referrer || CONFIG.botRedirectUrl;
                redirectUtils.redirect(fallbackUrl, CONFIG.baseRedirectDelay);
            } catch (redirectError) {
                console.error("Even fallback redirect failed:", redirectError);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
                redirectUtils.showManualRedirectButton(document.referrer || CONFIG.botRedirectUrl);
            }
        }
    };

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    init();
    </script>
</body>
</html>
